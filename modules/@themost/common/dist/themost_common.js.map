{"version":3,"file":"themost_common.js","sources":["../src/emitter.js","../src/http-error-codes.js","../src/errors.js","../src/utils.js","../src/config.js","../src/html.js","../src/app.js"],"sourcesContent":["/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2014-2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\n \r\nimport {EventEmitter} from 'events';\r\nimport {applyEachSeries} from 'async';\r\n\r\n/**\r\n * @classdesc SequentialEventEmitter class is an extension of node.js EventEmitter class where listeners are executing in series.\r\n * @class\r\n * @constructor\r\n * @augments EventEmitter\r\n */\r\nexport class SequentialEventEmitter extends EventEmitter {\r\n    /**\r\n     * Executes event listeners in series.\r\n     * @param {String} event - The event that is going to be executed.\r\n     * @param {...*} args - An object that contains the event arguments.\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    // tslint:disable-nex-lineb no-unused-variable\r\n    emit(event, _args) {\r\n        //get listeners\r\n        if (typeof this.listeners !== 'function') {\r\n            throw new Error('undefined listeners');\r\n        }\r\n        const listeners = this.listeners(event);\r\n\r\n        const argsAndCallback = [].concat(Array.prototype.slice.call(arguments, 1));\r\n        if (argsAndCallback.length > 0) {\r\n            //check the last argument (expected callback function)\r\n            if (typeof argsAndCallback[argsAndCallback.length - 1] !== \"function\") {\r\n                throw new TypeError(\"Expected event callback\");\r\n            }\r\n        }\r\n        //get callback function (the last argument of arguments list)\r\n        const callback = argsAndCallback[argsAndCallback.length - 1];\r\n\r\n        //validate listeners\r\n        if (listeners.length===0) {\r\n            //exit emitter\r\n            return callback();\r\n        }\r\n        //apply each series\r\n        return applyEachSeries.apply(this, [listeners].concat(argsAndCallback));\r\n    }\r\n}\r\n","/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\n \r\nconst Errors = [{\r\n    statusCode: 400,\r\n    title: \"Bad Request\",\r\n    message: \"The request cannot be fulfilled due to bad syntax.\"\r\n}, {\r\n    statusCode: 401,\r\n    title: \"Unauthorized\",\r\n    message: \"The request was a legal request, but requires user authentication.\"\r\n}, {\r\n    statusCode: 403,\r\n    title: \"Forbidden\",\r\n    message: \"The server understood the request, but is refusing to fulfill it.\"\r\n}, {\r\n    statusCode: 404,\r\n    title: \"Not Found\",\r\n    message: \"The requested resource could not be found but may be available again in the future.\"\r\n}, {\r\n    statusCode: 405,\r\n    title: \"Method Not Allowed\",\r\n    message: \"A request was made of a resource using a request method not supported by that resource.\"\r\n}, {\r\n    statusCode: 406,\r\n    title: \"Not Acceptable\",\r\n    message: \"The requested resource is only capable of generating content not acceptable according to the Accept headers sent in the request.\"\r\n}, {\r\n    statusCode: 407,\r\n    title: \"Proxy Authentication Required\",\r\n    message: \"The client must first authenticate itself with the proxy.\"\r\n}, {\r\n    statusCode: 408,\r\n    title: \"Request Timeout\",\r\n    message: \"The server timed out waiting for the request.\"\r\n}, {\r\n    statusCode: 409,\r\n    title: \"Conflict\",\r\n    message: \"The request could not be completed due to a conflict with the current state of the resource.\"\r\n}, {\r\n    statusCode: 410,\r\n    title: \"Gone\",\r\n    message: \"The resource requested is no longer available and will not be available again.\"\r\n}, {\r\n    statusCode: 411,\r\n    title: \"Length Required\",\r\n    message: \"The request did not specify the length of its content, which is required by the requested resource.\"\r\n}, {\r\n    statusCode: 412,\r\n    title: \"Precondition Failed\",\r\n    message: \"The server does not meet one of the preconditions that the requester put on the request.\"\r\n}, {\r\n    statusCode: 413,\r\n    title: \"Request Entity Too Large\",\r\n    message: \"The request is larger than the server is willing or able to process.\"\r\n}, {\r\n    statusCode: 414,\r\n    title: \"Request-URI Too Long\",\r\n    message: \"The URI provided was too long for the server to process.\"\r\n}, {\r\n    statusCode: 415,\r\n    title: \"Unsupported Media Type\",\r\n    message: \"The server is refusing to service the request because the payload is in a format not supported by this method on the target resource.\"\r\n}, {\r\n    statusCode: 416,\r\n    title: \"Requested Range Not Satisfiable\",\r\n    message: \"The client has asked for a portion of the file, but the server cannot supply that portion.\"\r\n}, {\r\n    statusCode: 417,\r\n    title: \"Expectation Failed\",\r\n    message: \"The server cannot meet the requirements of the Expect request-header field.\"\r\n}, {\r\n    statusCode: 496,\r\n    title: \"No Cert\",\r\n    message: \"The client must provide a certificate to fulfill the request.\"\r\n}, {\r\n    statusCode: 498,\r\n    title: \"Token expired\",\r\n    message: \"Token was expired or is in invalid state.\"\r\n}, {\r\n    statusCode: 499,\r\n    title: \"Token required\",\r\n    message: \"A token is required to fulfill the request.\"\r\n}, {\r\n    statusCode: 500,\r\n    title: \"Internal Server Error\",\r\n    message: \"The server encountered an internal error and was unable to complete your request.\"\r\n}, {\r\n    statusCode: 501,\r\n    title: \"Not Implemented\",\r\n    message: \"The server either does not recognize the request method, or it lacks the ability to fulfil the request.\"\r\n}, {\r\n    statusCode: 502,\r\n    title: \"Bad Gateway\",\r\n    message: \"The server was acting as a gateway or proxy and received an invalid response from the upstream server.\"\r\n}, {\r\n    statusCode: 503,\r\n    title: \"Service Unavailable\",\r\n    message: \"The server is currently unavailable (because it is overloaded or down for maintenance).\"\r\n}];\r\n\r\nmodule.exports.Errors = Errors;","/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2014-2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport {Errors as errors} from './http-error-codes';\r\n\r\n\r\n/**\r\n * @classdesc Thrown when an application tries to call an abstract method.\r\n * @class\r\n */\r\nexport class AbstractMethodError extends Error {\r\n    /**\r\n     * @param {string=} msg\r\n     */\r\n    constructor(msg) {\r\n        super(msg || 'Class does not implement inherited abstract method.');\r\n        if (typeof Error.captureStackTrace === 'function') {\r\n            Error.captureStackTrace(this, this.constructor);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Thrown when an application tries to instantiate an abstract class.\r\n * @class\r\n */\r\nexport class AbstractClassError extends Error {\r\n    /**\r\n     * @param {string=} msg\r\n     */\r\n    constructor(msg) {\r\n        super(msg || 'An abstract class cannot be instantiated.');\r\n        if (typeof Error.captureStackTrace === 'function') {\r\n            Error.captureStackTrace(this, this.constructor);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Represents an error with a code.\r\n * @class\r\n */\r\nexport class CodedError extends Error {\r\n    /**\r\n     * @param {string} msg\r\n     * @param {string} code\r\n     */\r\n    constructor(msg, code) {\r\n        super(msg);\r\n        this.code = code;\r\n        if (typeof Error.captureStackTrace === 'function') {\r\n            Error.captureStackTrace(this, this.constructor);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Thrown when an application tries to access a file which does not exist.\r\n * @class\r\n */\r\nexport class FileNotFoundError extends CodedError {\r\n    /**\r\n    * @param {string=} msg\r\n    */\r\n    constructor(msg) {\r\n        super(msg | 'File not found', \"EFOUND\");\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * @classdesc Represents an HTTP error.\r\n * @class\r\n * @param {number} status\r\n * @param {string=} message\r\n * @param {string=} innerMessage,\r\n * @constructor\r\n * @extends CodedError\r\n */\r\nexport class HttpError extends CodedError {\r\n    constructor(status, message, innerMessage) {\r\n        super(message, \"EHTTP\");\r\n        const finalStatus = (typeof status === 'number') ? parseInt(status, 10) : 500;\r\n        const err = errors.find( x => {\r\n            return x.statusCode === finalStatus;\r\n        });\r\n        if (err) {\r\n            this.title = err.title;\r\n            this.message = message || err.message;\r\n            this.statusCode = err.statusCode;\r\n        }\r\n        else {\r\n            this.title = 'Internal Server Error';\r\n            this.message = message || 'The server encountered an internal error and was unable to complete the request.';\r\n            this.statusCode = finalStatus\r\n        }\r\n        if (typeof innerMessage !== 'undefined') {\r\n            this.innerMessage = innerMessage;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated This static has been deprecated and it's going to be removed. Use default constructor instead.\r\n     * @param {Error=} err\r\n     * @returns {HttpError}\r\n     */\r\n    static create(err) {\r\n        if (err == null) {\r\n            return new HttpError(500);\r\n        }\r\n        if (err.hasOwnProperty('statusCode')) {\r\n            return Object.assign(new HttpError(err.statusCode, err.message), err);\r\n        }\r\n        else {\r\n            return Object.assign(new HttpError(500, err.message), err);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Represents a 400 HTTP Bad Request error.\r\n * @class\r\n */\r\nexport class HttpBadRequestError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(400, message, innerMessage);\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Represents a 404 HTTP Not Found error.\r\n * @class\r\n * @property {string} resource - Gets or sets the requested resource which could not to be found\r\n */\r\n export class HttpNotFoundError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(404, message, innerMessage);\r\n    }\r\n }\r\n/**\r\n * @classdesc Represents a 405 HTTP Method Not Allowed error.\r\n * @class\r\n */\r\nexport class HttpMethodNotAllowedError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(405, message, innerMessage);\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Represents a 401 HTTP Unauthorized error.\r\n * @class\r\n */\r\nexport class HttpUnauthorizedError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(401, message, innerMessage);\r\n    }\r\n}\r\n/**\r\n * @classdesc HTTP 406 Not Acceptable exception class\r\n * @class\r\n */\r\nexport class HttpNotAcceptableError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(406, message, innerMessage);\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc HTTP 408 RequestTimeout exception class\r\n * @class\r\n */\r\nexport class HttpRequestTimeoutError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(408, message, innerMessage);\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc HTTP 409 Conflict exception class\r\n * @class\r\n */\r\nexport class HttpConflictError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(409, message, innerMessage);\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc HTTP 498 Token Expired exception class\r\n * @class\r\n */\r\nexport class HttpTokenExpiredError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(498, message, innerMessage);\r\n    }\r\n}\r\n/**\r\n * @classdesc HTTP 499 Token Required exception class\r\n * @class\r\n */\r\nexport class HttpTokenRequiredError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(499, message, innerMessage);\r\n    }\r\n}\r\n/**\r\n * @classdesc Represents a 403 HTTP Forbidden error.\r\n * @class\r\n */\r\nexport class HttpForbiddenError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(403, message, innerMessage);\r\n    }\r\n}\r\n/**\r\n * @classdesc Represents a 500 HTTP Internal Server error.\r\n * @class\r\n */\r\nexport class HttpServerError extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(500, message, innerMessage);\r\n    }\r\n}\r\n/**\r\n * @classdesc Represents a 503 HTTP Service Unavailable.\r\n * @class\r\n */\r\nexport class HttpServiceUnavailable extends HttpError {\r\n    constructor(message, innerMessage) {\r\n        super(503, message, innerMessage);\r\n    }\r\n}\r\n/**\r\n * @classdesc Extends Error object for throwing exceptions on data operations\r\n * @class\r\n * @property {string} code - A string that represents an error code e.g. EDATA\r\n * @property {string} message -  The error message.\r\n * @property {string} innerMessage - The error inner message.\r\n * @property {number} status - A number that represents an error status. This error status may be used for throwing the appropriate HTTP error.\r\n * @property {*} additionalData - Additional data associated with this error\r\n */\r\nexport class DataError extends CodedError {\r\n    /**\r\n     * @param {string=} code - A string that represents an error code\r\n     * @param {string=} message - The error message\r\n     * @param {string=} innerMessage - The error inner message\r\n     * @param {string=} model - The target model\r\n     * @param {string=} field - The target field\r\n     * @param {*} additionalData - Additional data associated with this error\r\n     */\r\n    constructor(code, message, innerMessage, model, field, additionalData) {\r\n        super(message, code);\r\n        this.code = code || 'EDATA';\r\n        if (typeof model !== 'undefined') {\r\n            this.model = model;\r\n        }\r\n        if (typeof field !== 'undefined') {\r\n            this.field = field;\r\n        }\r\n        this.message = message || 'A general data error occured.';\r\n        if (typeof innerMessage !== 'undefined') {\r\n            this.innerMessage = innerMessage;\r\n        }\r\n        this.additionalData = additionalData;\r\n    }\r\n}\r\n\r\n/**\r\n * Thrown when an application attempts to access a data object that cannot be found.\r\n */\r\nexport class NotNullError extends DataError {\r\n    /**\r\n    * @param {string=} message - The error message\r\n    * @param {string=} innerMessage - The error inner message\r\n    * @param {string=} model - The target model\r\n    * @param {string=} field - The target field\r\n    */\r\n    constructor(message, innerMessage, model, field) {\r\n        super('ENULL', message || 'A value is required.', innerMessage, model, field);\r\n        this.statusCode = 409;\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc Thrown when an application attempts to access a data object that cannot be found.\r\n * @class\r\n */\r\nexport class DataNotFoundError extends DataError {\r\n    /**\r\n    * @param {string=} message - The error message\r\n    * @param {string=} innerMessage - The error inner message\r\n    * @param {string=} model - The target model\r\n    */\r\n    constructor(message, innerMessage, model) {\r\n        super('EFOUND', message || 'The requested data was not found.', innerMessage, model);\r\n        this.statusCode = 404;\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @classdesc Thrown when a data object operation is denied\r\n */\r\nexport class AccessDeniedError extends DataError {\r\n    /**\r\n    * @param {string=} message - The error message\r\n    * @param {string=} innerMessage - The error inner message\r\n    * @param {string=} model - The target model\r\n    */\r\n    constructor(message, innerMessage, model) {\r\n        super('EACCESS', ('Access Denied' || message), innerMessage, model);\r\n        this.statusCode = 401;\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @classdesc Thrown when a unique constraint is being violated\r\n */\r\nexport class UniqueConstraintError extends DataError {\r\n    /**\r\n    * @param {string=} message - The error message\r\n    * @param {string=} innerMessage - The error inner message\r\n    * @param {string=} model - The target model\r\n    */\r\n    constructor(message, innerMessage, model) {\r\n        super('EUNQ', message || 'A unique constraint violated', innerMessage, model);\r\n        this.statusCode = 409;\r\n    }\r\n}\r\n","/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2014-2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport {sprintf} from \"sprintf\";\r\n\r\nconst IS_NODE = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';\r\nconst UUID_CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst HEX_CHARS = 'abcdef1234567890';\r\nconst STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg;\r\nconst DATE_TIME_REGEX = /^\\d{4}-([0]\\d|1[0-2])-([0-2]\\d|3[01])(?:[T ](\\d+):(\\d+)(?::(\\d+)(?:\\.(\\d+))?)?)?(?:Z(-?\\d*))?$/g;\r\nconst BOOLEAN_TRUE_REGEX = /^true$/ig;\r\nconst BOOLEAN_FALSE_REGEX = /^false$/ig;\r\nconst NULL_REGEX = /^null$/ig;\r\nconst UNDEFINED_REGEX = /^undefined$/ig;\r\nconst INT_REGEX =/^[-+]?\\d+$/g;\r\nconst FLOAT_REGEX =/^[+-]?\\d+(\\.\\d+)?$/g;\r\nconst GUID_REGEX = /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;\r\n\r\nconst LOG_LEVELS = {\r\n    error: 0,\r\n    warn: 1,\r\n    info: 2,\r\n    verbose: 3,\r\n    debug: 4\r\n};\r\n\r\nexport class UnknownPropertyDescriptor {\r\n    constructor(obj, name) {\r\n        Object.defineProperty(this, 'value', { \r\n            configurable:false, \r\n            enumerable:true, \r\n            get: function() { \r\n                    return obj[name]; \r\n                }, \r\n            set: function(value) { \r\n                    obj[name]=value; \r\n                }\r\n        });\r\n        Object.defineProperty(this, 'name', { \r\n            configurable:false, \r\n            enumerable:true, \r\n            get: function() { \r\n                return name; \r\n                } \r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class LangUtils {\r\n    /**\r\n     * Inherit the prototype methods from one constructor into another.\r\n     * @param {Function} ctor\r\n     * @param {Function|*} superCtor\r\n     * @deprecated This method has been deprecated and it will be removed in next version\r\n     * @example\r\n    function Animal() {\r\n        //\r\n    }\r\n\r\n    function Dog() {\r\n        Dog.super_.bind(this)();\r\n    }\r\n    LangUtils.inherits(Dog,Animal);\r\n     */\r\n    static inherits(ctor, superCtor) {\r\n\r\n        if (typeof superCtor !== \"function\" && superCtor !== null) {\r\n            throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superCtor);\r\n        }\r\n\r\n        //if process is running under node js\r\n        if (IS_NODE) {\r\n            const utilModule = \"util\";\r\n            const util = require(utilModule);\r\n            //call util.inherits() function\r\n            return util.inherits(ctor, superCtor);\r\n        }\r\n\r\n        ctor.prototype = Object.create(superCtor && superCtor.prototype, {\r\n            constructor: {\r\n                value: ctor,\r\n                enumerable: false,\r\n                writable: true,\r\n                configurable: true\r\n            }\r\n        });\r\n        if (superCtor) {\r\n            /**\r\n             * @function setPrototypeOf\r\n             * @param {*} obj\r\n             * @param {*} prototype\r\n             * @memberOf Object\r\n             * @static\r\n             */\r\n            if (typeof Object.setPrototypeOf === 'function') {\r\n                Object.setPrototypeOf(ctor, superCtor)\r\n            }\r\n            else {\r\n                ctor.__proto__ = superCtor\r\n            }\r\n        }\r\n        //node.js As an additional convenience, superConstructor will be accessible through the constructor.super_ property.\r\n        ctor.super_ = ctor.__proto__;\r\n    }\r\n\r\n    /**\r\n     * Returns an array of strings which represents the arguments' names of the given function\r\n     * @param {Function} fn\r\n     * @returns {Array}\r\n     */\r\n    static getFunctionParams(fn) {\r\n        if (typeof fn === 'function')\r\n            return [];\r\n        const fnStr = fn.toString().replace(STRIP_COMMENTS, '');\r\n        let result = fnStr.slice(fnStr.indexOf('(')+1, fnStr.indexOf(')')).match(/([^\\s,]+)/g);\r\n        if(result === null)\r\n            result = [];\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * @param {string} value\r\n     */\r\n    static convert(value) {\r\n        let result;\r\n        if ((typeof value === 'string'))\r\n        {\r\n            if (value.length===0) {\r\n                result = value\r\n            }\r\n            if (value.match(BOOLEAN_TRUE_REGEX)) {\r\n                result = true;\r\n            }\r\n            else if (value.match(BOOLEAN_FALSE_REGEX)) {\r\n                result = false;\r\n            }\r\n            else if (value.match(NULL_REGEX) || value.match(UNDEFINED_REGEX)) {\r\n                result = null;\r\n            }\r\n            else if (value.match(INT_REGEX)) {\r\n                result = parseInt(value);\r\n            }\r\n            else if (value.match(FLOAT_REGEX)) {\r\n                result = parseFloat(value);\r\n            }\r\n            else if (value.match(DATE_TIME_REGEX)) {\r\n                result = new Date(Date.parse(value));\r\n            }\r\n            else {\r\n                result = value;\r\n            }\r\n        }\r\n        else {\r\n            result = value;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {*} origin\r\n     * @param {string} expr\r\n     * @param {string} value\r\n     * @param {*=} options\r\n     * @returns {*}\r\n     */\r\n    static extend(origin, expr, value, options) {\r\n\r\n        options = options || { convertValues:false };\r\n        //find base notation\r\n        let match = /(^\\w+)\\[/.exec(expr), name, descriptor, expr1;\r\n        if (match) {\r\n            //get property name\r\n            name = match[1];\r\n            //validate array property\r\n            if (/^\\d+$/g.test(name)) {\r\n                //property is an array\r\n                if (!Array.isArray(origin.value))\r\n                    origin.value = [];\r\n                // get new expression\r\n                expr1 = expr.substr(match.index + match[1].length);\r\n                LangUtils.extend(origin, expr1, value, options);\r\n            }\r\n            else {\r\n                //set property value (unknown)\r\n                origin[name] = origin[name] || new LangUtils();\r\n                descriptor = new UnknownPropertyDescriptor(origin, name);\r\n                // get new expression\r\n                expr1 = expr.substr(match.index + match[1].length);\r\n                LangUtils.extend(descriptor, expr1, value, options);\r\n            }\r\n        }\r\n        else if (expr.indexOf('[')===0) {\r\n            //get property\r\n            const re = /\\[(.*?)\\]/g;\r\n            match = re.exec(expr);\r\n            if (match) {\r\n                name = match[1];\r\n                // get new expression\r\n                expr1 = expr.substr(match.index + match[0].length);\r\n                if (/^\\d+$/g.test(name)) {\r\n                    //property is an array\r\n                    if (!Array.isArray(origin.value))\r\n                        origin.value = [];\r\n                }\r\n                if (expr1.length===0) {\r\n                    if (origin.value instanceof LangUtils) {\r\n                        origin.value = {};\r\n                    }\r\n                    let typedValue;\r\n                    //convert string value\r\n                    if ((typeof value === 'string') && options.convertValues) {\r\n                        typedValue = LangUtils.convert(value);\r\n                    }\r\n                    else {\r\n                        typedValue = value;\r\n                    }\r\n                    if (Array.isArray(origin.value))\r\n                        origin.value.push(typedValue);\r\n                    else\r\n                        origin.value[name] = typedValue;\r\n                }\r\n                else {\r\n                    if (origin.value instanceof LangUtils) {\r\n                        origin.value = { };\r\n                    }\r\n                    origin.value[name] = origin.value[name] || new LangUtils();\r\n                    descriptor = new UnknownPropertyDescriptor(origin.value, name);\r\n                    LangUtils.extend(descriptor, expr1, value, options);\r\n                }\r\n            }\r\n            else {\r\n                throw new Error('Invalid object property notation. Expected [name]');\r\n            }\r\n        }\r\n        else if (/^\\w+$/.test(expr)) {\r\n            if (options.convertValues)\r\n                origin[expr] = LangUtils.convert(value);\r\n            else\r\n                origin[expr] = value;\r\n        }\r\n        else {\r\n            throw new Error('Invalid object property notation. Expected property[name] or [name]');\r\n        }\r\n        return origin;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {*} form\r\n     * @param {*=} options\r\n     * @returns {*}\r\n     */\r\n    static parseForm(form, options) {\r\n        const result = {};\r\n        if (typeof form === 'undefined' || form===null)\r\n            return result;\r\n        const keys = Object.keys(form);\r\n        keys.forEach(key => {\r\n            if (form.hasOwnProperty(key))\r\n            {\r\n                LangUtils.extend(result, key, form[key], options)\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Parses any value or string and returns the resulted object.\r\n     * @param {*} any\r\n     * @returns {*}\r\n     */\r\n    static parseValue(any) {\r\n        return LangUtils.convert(any);\r\n    }\r\n\r\n    /**\r\n     * Parses any value and returns the equivalent integer.\r\n     * @param {*} any\r\n     * @returns {*}\r\n     */\r\n    static parseInt(any) {\r\n        return parseInt(any) || 0;\r\n    }\r\n\r\n    /**\r\n     * Parses any value and returns the equivalent float number.\r\n     * @param {*} any\r\n     * @returns {*}\r\n     */\r\n    static parseFloat(any) {\r\n        return parseFloat(any) || 0;\r\n    }\r\n\r\n    /**\r\n     * Parses any value and returns the equivalent boolean.\r\n     * @param {*} any\r\n     * @returns {*}\r\n     */\r\n    static parseBoolean(any) {\r\n        if (typeof any === 'undefined' || any === null)\r\n            return false;\r\n        else if (typeof any === 'number')\r\n            return any !== 0;\r\n        else if (typeof any === 'string') {\r\n            if (any.match(INT_REGEX) || any.match(FLOAT_REGEX)) {\r\n                return parseInt(any, 10) !== 0;\r\n            }\r\n            else if (any.match(BOOLEAN_TRUE_REGEX))\r\n                return true;\r\n            else if (any.match(BOOLEAN_FALSE_REGEX))\r\n                return false;\r\n            else if (/^yes$|^on$|^y$|^valid$/i.test(any))\r\n                return true;\r\n            else if (/^no$|^off$|^n$|^invalid$/i.test(any))\r\n                return false;\r\n            else\r\n                return false;\r\n        }\r\n        else if (typeof any === 'boolean')\r\n            return any;\r\n        else {\r\n            return (parseInt(any) || 0) !== 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @static\r\n     * Checks if the given value is a valid date\r\n     * @param {*} value\r\n     * @returns {boolean}\r\n     */\r\n    static isDate(value) {\r\n        if (value instanceof Date) {\r\n            return true;\r\n        }\r\n        return DATE_TIME_REGEX.test(value);\r\n    }\r\n}\r\n\r\n/**\r\n * @function captureStackTrace\r\n * @memberOf Error\r\n * @param {Error} thisArg\r\n * @param {string} name\r\n * @static\r\n */\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class Args {\r\n    /**\r\n     * Checks the expression and throws an exception if the condition is not met.\r\n     * @param {*} expr\r\n     * @param {string|Error} err\r\n     */\r\n    static check(expr, err) {\r\n        Args.notNull(expr,\"Expression\");\r\n        let res;\r\n        if (typeof expr === 'function') {\r\n            res = !(expr.call());\r\n        }\r\n        else {\r\n            res = (!expr);\r\n        }\r\n        if (res) {\r\n            if (err instanceof Error) {\r\n                throw err;\r\n            }\r\n            throw new ArgumentError(err, \"ECHECK\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {*} arg\r\n     * @param {string} name\r\n     */\r\n    static notNull(arg, name) {\r\n        if (typeof arg === 'undefined' || arg === null) {\r\n            throw new ArgumentError(name + \" may not be null or undefined\", \"ENULL\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {*} arg\r\n     * @param {string} name\r\n     */\r\n    static notString(arg, name) {\r\n        if (typeof arg !== 'string') {\r\n            throw new ArgumentError(name + \" must be a string\", \"EARG\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {*} arg\r\n     * @param {string} name\r\n     */\r\n    static notFunction(arg, name) {\r\n        if (typeof arg !== 'function') {\r\n            throw new ArgumentError(name + \" must be a function\", \"EARG\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {*} arg\r\n     * @param {string} name\r\n     */\r\n    static notNumber(arg, name) {\r\n        if ((typeof arg !== 'number') || isNaN(arg)) {\r\n            throw new ArgumentError(name + \" must be number\", \"EARG\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {string|*} arg\r\n     * @param {string} name\r\n     */\r\n    static notEmpty(arg, name) {\r\n        Args.notNull(arg,name);\r\n        if ((Object.prototype.toString.bind(arg)() === '[object Array]') && (arg.length === 0)) {\r\n            throw new ArgumentError(name + \" may not be empty\",\"EEMPTY\");\r\n        }\r\n        else if ((typeof arg === 'string') && (arg.length===0)) {\r\n            throw new ArgumentError(name + \" may not be empty\",\"EEMPTY\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {number|*} arg\r\n     * @param {string} name\r\n     */\r\n    static notNegative(arg, name) {\r\n        Args.notNumber(arg,name);\r\n        if (arg<0) {\r\n            throw new ArgumentError(name + \" may not be negative\", \"ENEG\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {number|*} arg\r\n     * @param {string} name\r\n     */\r\n    static notPositive(arg, name) {\r\n        Args.notNumber(arg,name);\r\n        if (arg<=0) {\r\n            throw new ArgumentError(name + \" may not be negative or zero\", \"EPOS\");\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class TextUtils {\r\n    /**\r\n     * Converts the given parameter to MD5 hex string\r\n     * @static\r\n     * @param {*} value\r\n     * @returns {string|undefined}\r\n     */\r\n    static toMD5(value) {\r\n\r\n        if (typeof value === 'undefined' || value === null) {\r\n            return;\r\n        }\r\n        //browser implementation\r\n        let md5, md5module;\r\n        if (typeof window !== 'undefined') {\r\n            md5module = 'blueimp-md5';\r\n            md5 = require(md5module);\r\n            if (typeof value === 'string') {\r\n                return md5(value);\r\n            }\r\n            else if (value instanceof Date) {\r\n                return md5(value.toUTCString());\r\n            }\r\n            else {\r\n                return md5(JSON.stringify(value));\r\n            }\r\n        }\r\n        //node.js implementation\r\n        md5module = 'crypto';\r\n        const crypto = require(md5module);\r\n        md5 = crypto.createHash('md5');\r\n        if (typeof value === 'string') {\r\n            md5.update(value);\r\n        }\r\n        else if (value instanceof Date) {\r\n            md5.update(value.toUTCString());\r\n        }\r\n        else {\r\n            md5.update(JSON.stringify(value));\r\n        }\r\n        return md5.digest('hex');\r\n    }\r\n\r\n    /**\r\n     * Converts the given parameter to SHA1 hex string\r\n     * @static\r\n     * @param {*} value\r\n     * @returns {string|undefined}\r\n     */\r\n    static toSHA1(value) {\r\n\r\n        const cryptoModule = 'crypto';\r\n        if (typeof window !== 'undefined') {\r\n            throw new Error('This method is not implemented for this environment')\r\n        }\r\n\r\n        const crypto = require(cryptoModule);\r\n        if (typeof value === 'undefined' || value === null) {\r\n            return;\r\n        }\r\n        const sha1 = crypto.createHash('sha1');\r\n        if (typeof value === 'string') {\r\n            sha1.update(value);\r\n        }\r\n        else if (value instanceof Date) {\r\n            sha1.update(value.toUTCString());\r\n        }\r\n        else {\r\n            sha1.update(JSON.stringify(value));\r\n        }\r\n        return sha1.digest('hex');\r\n    }\r\n\r\n    /**\r\n     * Converts the given parameter to SHA256 hex string\r\n     * @static\r\n     * @param {*} value\r\n     * @returns {string|undefined}\r\n     */\r\n    static toSHA256(value) {\r\n\r\n        const cryptoModule = 'crypto';\r\n        if (typeof window !== 'undefined') {\r\n            throw new Error('This method is not implemented for this environment')\r\n        }\r\n\r\n        const crypto = require(cryptoModule);\r\n        if (typeof value === 'undefined' || value === null) {\r\n            return;\r\n        }\r\n        const sha256 = crypto.createHash('sha256');\r\n        if (typeof value === 'string') {\r\n            sha256.update(value);\r\n        }\r\n        else if (value instanceof Date) {\r\n            sha256.update(value.toUTCString());\r\n        }\r\n        else {\r\n            sha256.update(JSON.stringify(value));\r\n        }\r\n        return sha256.digest('hex');\r\n    }\r\n\r\n    /**\r\n     * Returns a random GUID/UUID string\r\n     * @static\r\n     * @returns {string}\r\n     */\r\n    static newUUID() {\r\n        const chars = UUID_CHARS;\r\n        const uuid = [];\r\n        // rfc4122, version 4 form\r\n        let r = void 0;\r\n        // rfc4122 requires these characters\r\n        uuid[8] = uuid[13] = uuid[18] = uuid[23] = \"-\";\r\n        uuid[14] = \"4\";\r\n\r\n        // Fill in random data.  At i==19 set the high bits of clock sequence as\r\n        // per rfc4122, sec. 4.1.5\r\n        for (let i = 0; i < 36; i++) {\r\n            if (!uuid[i]) {\r\n                r = 0 | Math.random() * 16;\r\n                uuid[i] = chars[i === 19 ? r & 0x3 | 0x8 : r];\r\n            }\r\n        }\r\n        return uuid.join(\"\");\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @param {*} options\r\n * @constructor\r\n */\r\nexport class TraceLogger {\r\n    constructor(options) {\r\n        this.options = {\r\n            colors:false,\r\n            level:\"info\"\r\n        };\r\n        if (typeof options === \"undefined\" && options !== null && IS_NODE) {\r\n            if (IS_NODE && process.env.NODE_ENV === \"development\") {\r\n                this.options.level = \"debug\";\r\n            }\r\n        }\r\n        if (typeof options !== \"undefined\" && options !== null ) {\r\n            this.options = options;\r\n            //validate logging level\r\n            Args.check(LOG_LEVELS.hasOwnProperty(this.options.level), \"Invalid logging level. Expected error, warn, info, verbose or debug.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {string} level\r\n     * @returns {*}\r\n     */\r\n    level(level) {\r\n        Args.check(LOG_LEVELS.hasOwnProperty(level), \"Invalid logging level. Expected error, warn, info, verbose or debug.\");\r\n        this.options.level = level;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @param {...*} data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    log(data) {\r\n        const args = Array.prototype.slice.call(arguments);\r\n        if (typeof data === 'undefined' || data === null) {\r\n            return;\r\n        }\r\n        if (data instanceof Error) {\r\n            return writeError.bind(this)(\"info\",data);\r\n        }\r\n        if (typeof data !== 'string') {\r\n            return this.write(\"info\", data.toString());\r\n        }\r\n        if (args.length>1) {\r\n            return this.write(\"info\", sprintf.apply(null, args));\r\n        }\r\n        this.write(\"info\", data);\r\n    }\r\n\r\n    /**\r\n     * @param {...*} data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    info(data) {\r\n        const args = Array.prototype.slice.call(arguments);\r\n        if (typeof data === 'undefined' || data === null) {\r\n            return;\r\n        }\r\n        if (data instanceof Error) {\r\n            return writeError.bind(this)(\"info\",data);\r\n        }\r\n        if (typeof data !== 'string') {\r\n            return this.write(\"info\", data.toString());\r\n        }\r\n        if (args.length>1) {\r\n            return this.write(\"info\", sprintf.apply(null, args));\r\n        }\r\n        this.write(\"info\", data);\r\n    }\r\n\r\n    /**\r\n     * @param {...*} data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    error(data) {\r\n        const args = Array.prototype.slice.call(arguments);\r\n        if (typeof data === 'undefined' || data === null) {\r\n            return;\r\n        }\r\n        if (data instanceof Error) {\r\n            return writeError.bind(this)(\"error\",data);\r\n        }\r\n        if (typeof data !== 'string') {\r\n            return this.write(\"error\", data.toString());\r\n        }\r\n        if (args.length>1) {\r\n            return this.write(\"error\", sprintf.apply(null, args));\r\n        }\r\n        this.write(\"error\", data);\r\n    }\r\n\r\n    /**\r\n     * @param {...*} data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    warn(data) {\r\n        const args = Array.prototype.slice.call(arguments);\r\n        if (typeof data === 'undefined' || data === null) {\r\n            return;\r\n        }\r\n        if (data instanceof Error) {\r\n            return writeError.bind(this)(\"warn\",data);\r\n        }\r\n        if (typeof data !== 'string') {\r\n            return this.write(\"warn\", data.toString());\r\n        }\r\n        if (args.length>1) {\r\n            return this.write(\"warn\", sprintf.apply(null, args));\r\n        }\r\n        this.write(\"warn\", data);\r\n    }\r\n\r\n    /**\r\n     * @param {...*} data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    verbose(data) {\r\n        const args = Array.prototype.slice.call(arguments);\r\n        if (typeof data === 'undefined' || data === null) {\r\n            return;\r\n        }\r\n        if (data instanceof Error) {\r\n            return writeError.bind(this)(\"verbose\",data);\r\n        }\r\n        if (typeof data !== 'string') {\r\n            return this.write(\"verbose\", data.toString());\r\n        }\r\n        if (args.length>1) {\r\n            return this.write(\"verbose\", sprintf.apply(null, args));\r\n        }\r\n        this.write(\"verbose\", data);\r\n    }\r\n\r\n    /**\r\n     * @param {...*} data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    debug(data) {\r\n        const args = Array.prototype.slice.call(arguments);\r\n        if (typeof data === 'undefined' || data === null) {\r\n            return;\r\n        }\r\n        if (data instanceof Error) {\r\n            return writeError.bind(this)(\"debug\",data);\r\n        }\r\n        if (typeof data !== 'string') {\r\n            return this.write(\"debug\", data.toString());\r\n        }\r\n        if (args.length>1) {\r\n            return this.write(\"debug\", sprintf.apply(null, args));\r\n        }\r\n        this.write(\"debug\", data);\r\n\r\n    }\r\n\r\n    write(level, text) {\r\n        if (LOG_LEVELS[level]>LOG_LEVELS[this.options.level]) {\r\n            return;\r\n        }\r\n        // eslint-disable-next-line no-console\r\n        console.log(timestamp() + \" [\" + level.toUpperCase() + \"] \" + text);\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class TraceUtils {\r\n    static useLogger(logger) {\r\n        TraceUtils._logger = logger;\r\n    }\r\n\r\n    static level(level) {\r\n        TraceUtils._logger.level(level);\r\n    }\r\n\r\n    /**\r\n     * @static\r\n     * @param {...*} _data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static log(_data) {\r\n        TraceUtils._logger.log.apply(TraceUtils._logger, Array.prototype.slice.call(arguments));\r\n    }\r\n\r\n    /**\r\n     * @static\r\n     * @param {...*} _data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static error(_data) {\r\n        TraceUtils._logger.error.apply(TraceUtils._logger, Array.prototype.slice.call(arguments));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @static\r\n     * @param {...*} _data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static info(_data) {\r\n        TraceUtils._logger.info.apply(TraceUtils._logger, Array.prototype.slice.call(arguments));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @static\r\n     * @param {*} _data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static warn(_data) {\r\n        TraceUtils._logger.warn.apply(TraceUtils._logger, Array.prototype.slice.call(arguments));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @static\r\n     * @param {*} _data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static verbose(_data) {\r\n        TraceUtils._logger.verbose.apply(TraceUtils._logger, Array.prototype.slice.call(arguments));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @static\r\n     * @param {...*} _data\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static debug(_data) {\r\n        TraceUtils._logger.debug.apply(TraceUtils._logger, Array.prototype.slice.call(arguments));\r\n    }\r\n}\r\nObject.defineProperty(TraceUtils, '_logger', {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value: new TraceLogger()\r\n});\r\n\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class RandomUtils {\r\n    /**\r\n     * Returns a random string based on the length specified\r\n     * @param {Number} length\r\n     */\r\n    static randomChars(length) {\r\n        length = length || 8;\r\n        const chars = \"abcdefghkmnopqursuvwxz2456789ABCDEFHJKLMNPQURSTUVWXYZ\";\r\n        let str = \"\";\r\n        for(let i = 0; i < length; i++) {\r\n            str += chars.substr(this.randomInt(0, chars.length-1),1);\r\n        }\r\n        return str;\r\n    }\r\n\r\n    /**\r\n     * Returns a random integer between a minimum and a maximum value\r\n     * @param {number} min\r\n     * @param {number} max\r\n     */\r\n    static randomInt(min, max) {\r\n        return Math.floor(Math.random() * (max - min + 1)) + min;\r\n    }\r\n\r\n    /**\r\n     * Returns a random string based on the length specified\r\n     * @static\r\n     * @param {number} length\r\n     * @returns {string}\r\n     */\r\n    static randomHex(length) {\r\n        length = (length || 8)*2;\r\n        let str = \"\";\r\n        for(let i = 0; i < length; i++) {\r\n            str += HEX_CHARS.substr(this.randomInt(0, HEX_CHARS.length-1),1);\r\n        }\r\n        return str;\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class NumberUtils {\r\n    /**\r\n     * Converts a base-26 formatted string to the equivalent integer\r\n     * @static\r\n     * @param {string} s A base-26 formatted string e.g. aaaaaaaa for 0, baaaaaaa for 1 etc\r\n     * @return {number} The equivalent integer value\r\n     */\r\n    static fromBase26(s) {\r\n        let num = 0;\r\n        if (!/[a-z]{8}/.test(s)) {\r\n            throw new Error('Invalid base-26 format.');\r\n        }\r\n        const a = 'a'.charCodeAt(0);\r\n        for (let i = 7; i >=0; i--) {\r\n            num = (num * 26) + (s[i].charCodeAt(0) - a);\r\n        }\r\n        return num;\r\n    }\r\n\r\n    /**\r\n     * Converts an integer to the equivalent base-26 formatted string\r\n     * @static\r\n     * @param {number} x The integer to be converted\r\n     * @return {string} The equivalent string value\r\n     */\r\n    static toBase26(x) {\r\n        //noinspection ES6ConvertVarToLetConst\r\n        var num = parseInt(x);\r\n        if (num<0) {\r\n            throw new Error('A non-positive integer cannot be converted to base-26 format.');\r\n        }\r\n        if (num>208827064575) {\r\n            throw new Error('A positive integer bigger than 208827064575 cannot be converted to base-26 format.');\r\n        }\r\n        let out = \"\";\r\n        let length = 1;\r\n        const a = 'a'.charCodeAt(0);\r\n        while(length<=8)\r\n        {\r\n            out += String.fromCharCode(a + (num % 26));\r\n            num = Math.floor(num / 26);\r\n            length += 1;\r\n        }\r\n        return out;\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n */\r\nexport class PathUtils {\r\n    /**\r\n     *\r\n     * @param {...string} _part\r\n     * @returns {string}\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    static join(_part) {\r\n        const pathModule = \"path\";\r\n        if (IS_NODE) {\r\n            const path = require(pathModule);\r\n            return path.join.apply(null, Array.prototype.slice.call(arguments));\r\n        }\r\n        // Split the inputs into a list of path commands.\r\n        let parts = [], i, l;\r\n        for (i = 0, l = arguments.length; i < l; i++) {\r\n            parts = parts.concat(arguments[i].split(\"/\"));\r\n        }\r\n    // Interpret the path commands to get the new resolved path.\r\n        const newParts = [];\r\n        for (i = 0, l = parts.length; i < l; i++) {\r\n            const part1 = parts[i];\r\n            // Remove leading and trailing slashes\r\n            // Also remove \".\" segments\r\n            if (!part1 ||(part1 === \".\")) continue;\r\n            // Interpret \"..\" to pop the last segment\r\n            if (part1 === \"..\") newParts.pop();\r\n            // Push new path segments.\r\n            else newParts.push(part1);\r\n        }\r\n    // Preserve the initial slash if there was one.\r\n        if (parts[0] === \"\") newParts.unshift(\"\");\r\n    // Turn back into a single string path.\r\n        return newParts.join(\"/\") || (newParts.length ? \"/\" : \".\");\r\n    }\r\n}\r\n\r\n/**\r\n * @private\r\n * @returns {string}\r\n */\r\nfunction timestamp() {\r\n    return (new Date()).toUTCString();\r\n}\r\n\r\n/**\r\n * @private\r\n * @this TraceLogger\r\n * @param level\r\n * @param err\r\n */\r\nfunction writeError(level, err) {\r\n\r\n    const keys = Object.keys(err).filter(x => {\r\n        return err.hasOwnProperty(x) && x !== 'message' && typeof err[x] !== 'undefined' && err[x] != null;\r\n    });\r\n    if (err instanceof Error) {\r\n        if (err.hasOwnProperty('stack')) {\r\n            this.write(level, err.stack);\r\n        }\r\n        else {\r\n            this.write(level, err.toString());\r\n        }\r\n    }\r\n    else {\r\n        this.write(level, err.toString());\r\n    }\r\n    if (keys.length>0) {\r\n        this.write(level, \"Error: \" + keys.map( x => {\r\n            return \"[\" + x + \"]=\" + err[x].toString()\r\n        }).join(', '));\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * @param {number} value\r\n * @constructor\r\n */\r\nexport class Base26Number {\r\n\r\n    constructor(value) {\r\n        const thisValue = value;\r\n        this.toString = () => {\r\n            return Base26Number.toBase26(thisValue);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {number} x\r\n     * @returns {string}\r\n     */\r\n    static toBase26(x) {\r\n        let num = Math.floor(x | 0);\r\n        if (num<0) {\r\n            throw new Error(\"A non-positive integer cannot be converted to base-26 format.\");\r\n        }\r\n        if (num>208827064575) {\r\n            throw new Error(\"A positive integer bigger than 208827064575 cannot be converted to base-26 format.\");\r\n        }\r\n        let out = \"\";\r\n        let length = 1;\r\n        const a = \"a\".charCodeAt(0);\r\n        while(length<=8) {\r\n            out += String.fromCharCode(a + (num % 26));\r\n            num = Math.floor(num / 26);\r\n            length += 1;\r\n        }\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} s\r\n     * @returns {number}\r\n     */\r\n    static fromBase26(s) {\r\n        let num = 0;\r\n        if (!/[a-z]{8}/.test(s)) {\r\n            throw new Error(\"Invalid base-26 format.\");\r\n        }\r\n        const a = \"a\".charCodeAt(0);\r\n        for (let i = 7; i >=0; i--) {\r\n            num = (num * 26) + (s[i].charCodeAt(0) - a);\r\n        }\r\n        return num;\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @param {string=} value\r\n * @constructor\r\n */\r\nexport class Guid {\r\n    constructor(value) {\r\n        let _value;\r\n        if (typeof value === \"string\") {\r\n            // format value\r\n            _value = value.replace(/^{/,\"\").replace(/{$/,\"\");\r\n            // and validate\r\n            Args.check(GUID_REGEX.test(_value),\"Value must be a valid UUID\");\r\n        }\r\n        else {\r\n            // generate a new guid string\r\n            _value = TextUtils.newUUID();\r\n        }\r\n        // define property\r\n        Object.defineProperty(this, '_value', {\r\n                enumerable: false,\r\n                configurable: true,\r\n                value: _value\r\n            });\r\n    }\r\n\r\n    toJSON() {\r\n        return this._value;\r\n    }\r\n\r\n    valueOf() {\r\n        return this._value;\r\n    }\r\n\r\n    toString() {\r\n        return this._value;\r\n    }\r\n\r\n    equals(b) {\r\n        if (b instanceof Guid) {\r\n            return this._value.toLowerCase() === b._value.toLowerCase();\r\n        }\r\n        if (typeof b === 'string') {\r\n            return this._value.toLowerCase() === b.toLowerCase();\r\n        }\r\n        return this._value === b;\r\n    }\r\n\r\n    /**\r\n     * @param {string|*} s\r\n     * @returns {boolean}\r\n     */\r\n    static isGuid(s) {\r\n        if (s instanceof Guid) {\r\n            return true;\r\n        }\r\n        if (typeof s !== \"string\") {\r\n            return false;\r\n        }\r\n        return GUID_REGEX.test(s);\r\n    }\r\n\r\n    /**\r\n     * @returns {Guid}\r\n     */\r\n    static newGuid() {\r\n        return new Guid();\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends Error {\r\n    /**\r\n    * @param {string} msg\r\n    * @param {string} code\r\n    */\r\n    constructor(msg, code) {\r\n        super(msg);\r\n        this.code = code || \"ERR_ARG\";\r\n        if (typeof Error.captureStackTrace === 'function') {\r\n            Error.captureStackTrace(this, this.constructor);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2014-2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport _ from 'lodash';\r\nimport {Args} from './utils';\r\nimport {TraceUtils} from './utils';\r\nimport {PathUtils} from './utils';\r\nimport {AbstractClassError} from './errors';\r\n\r\nfunction cwd() {\r\n    //node.js mode\r\n    if (process && typeof process.cwd === 'function') {\r\n        return process.cwd();\r\n    }\r\n    //browser mode\r\n    else if (window && window.location && window.location.pathname) {\r\n        return '.';\r\n    }\r\n}\r\n\r\n/**\r\n * @class Represents an application configuration\r\n * @param {string=} configPath\r\n * @property {*} settings\r\n * @constructor\r\n */\r\nexport class ConfigurationBase {\r\n    constructor(configPath) {\r\n        \r\n        // set strategies\r\n        Object.defineProperty(this, '_strategies', {\r\n            enumerable: false,\r\n            writable: false,\r\n            value: { }\r\n        });\r\n\r\n        // set configuration path\r\n        Object.defineProperty(this, '_configurationPath', {\r\n            enumerable: false,\r\n            writable: true,\r\n            value: configPath || PathUtils.join(cwd(),'config')\r\n        });\r\n        TraceUtils.debug(`Initializing configuration under ${this._configurationPath}.`);\r\n\r\n        // set execution path\r\n        Object.defineProperty(this, '_executionPath', {\r\n            enumerable: false,\r\n            writable: true,\r\n            value: PathUtils.join(this._configurationPath,'..')\r\n        });\r\n        TraceUtils.debug(`Setting execution path under ${this._executionPath}`);\r\n\r\n        \r\n\r\n        //load default module loader strategy\r\n        this.useStrategy(ModuleLoaderStrategy, DefaultModuleLoaderStrategy);\r\n\r\n        //get configuration source\r\n        let configSourcePath;\r\n        let _config;\r\n        try {\r\n            let env = 'production';\r\n            //node.js mode\r\n            if (process && process.env) {\r\n                env = process.env['NODE_ENV'] || 'production';\r\n            }\r\n            //browser mode\r\n            else if (window && window.env) {\r\n                env = window.env['BROWSER_ENV'] || 'production';\r\n            }\r\n            configSourcePath = PathUtils.join(this._configurationPath, 'app.' + env + '.json');\r\n            TraceUtils.debug(`Validating environment configuration source on ${configSourcePath}.`);\r\n            _config = require(configSourcePath);\r\n        }\r\n        catch (err) {\r\n            if (err.code === 'MODULE_NOT_FOUND') {\r\n                TraceUtils.log('The environment specific configuration cannot be found or is inaccesible.');\r\n                try {\r\n                    configSourcePath = PathUtils.join(this._configurationPath, 'app.json');\r\n                    TraceUtils.debug(`Validating application configuration source on ${configSourcePath}.`);\r\n                    _config = require(configSourcePath);\r\n                }\r\n                catch(err) {\r\n                    if (err.code === 'MODULE_NOT_FOUND') {\r\n                        TraceUtils.log('The default application configuration cannot be found or is inaccesible.');\r\n                    }\r\n                    else {\r\n                        TraceUtils.error('An error occured while trying to open default application configuration.');\r\n                        TraceUtils.error(err);\r\n                    }\r\n                    TraceUtils.debug('Initializing empty configuration');\r\n                    _config = { };\r\n                }\r\n            }\r\n            else {\r\n                TraceUtils.error('An error occured while trying to open application configuration.');\r\n                TraceUtils.error(err);\r\n                //load default configuration\r\n                _config = { };\r\n            }\r\n        }\r\n\r\n        // set config source\r\n        Object.defineProperty(this, '_config', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            value: _config\r\n        });\r\n\r\n        //initialize settings object\r\n        this._config.settings = this._config.settings || { };\r\n\r\n        /**\r\n         * @name ConfigurationBase#settings\r\n         * @type {*}\r\n         */\r\n\r\n        Object.defineProperty(this, 'settings',{\r\n            get: function() {\r\n                return this._config.settings;\r\n            },\r\n            enumerable:false,\r\n            configurable:false\r\n        });\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Returns the configuration source object\r\n     * @returns {*}\r\n     */\r\n    getSource() {\r\n        return this._config;\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Returns the source configuration object based on the given path (e.g. settings.auth.cookieName or settings/auth/cookieName)\r\n     * @param {string} p - A string which represents an object path\r\n     * @returns {Object|Array}\r\n     */\r\n    getSourceAt(p) {\r\n        return _.at(this._config,p.replace(/\\//g,'.'))[0];\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Returns a boolean which indicates whether the specified  object path exists or not (e.g. settings.auth.cookieName or settings/auth/cookieName)\r\n     * @param {string} p - A string which represents an object path\r\n     * @returns {boolean}\r\n     */\r\n    hasSourceAt(p) {\r\n        return typeof _.at(this._config,p.replace(/\\//g,'.'))[0] !== 'undefined';\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Sets the config value to the specified object path (e.g. settings.auth.cookieName or settings/auth/cookieName)\r\n     * @param {string} p - A string which represents an object path\r\n     * @param {*} value\r\n     * @returns {Object}\r\n     */\r\n    setSourceAt(p, value) {\r\n        return _.set(this._config, p.replace(/\\//g,'.'), value);\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Sets the current execution path\r\n     * @param {string} p\r\n     * @returns ConfigurationBase\r\n     */\r\n    setExecutionPath(p) {\r\n        this._executionPath = p;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets the current execution path\r\n     * @returns {string}\r\n     */\r\n    getExecutionPath() {\r\n        return this._executionPath;\r\n    }\r\n\r\n    /**\r\n     * Gets the current configuration path\r\n     * @returns {string}\r\n     */\r\n    getConfigurationPath() {\r\n        return this._configurationPath;\r\n    }\r\n\r\n    /**\r\n     * Register a configuration strategy\r\n     * @param {Function} configStrategyCtor\r\n     * @param {Function} strategyCtor\r\n     * @returns ConfigurationBase\r\n     */\r\n    useStrategy(configStrategyCtor, strategyCtor) {\r\n        Args.notFunction(configStrategyCtor,\"Configuration strategy constructor\");\r\n        Args.notFunction(strategyCtor,\"Strategy constructor\");\r\n        this._strategies[\"$\".concat(configStrategyCtor.name)] = new strategyCtor(this);\r\n        return this;\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Gets a configuration strategy\r\n     * @param {Function} configStrategyCtor\r\n     */\r\n    getStrategy(configStrategyCtor) {\r\n        Args.notFunction(configStrategyCtor,\"Configuration strategy constructor\");\r\n        return this._strategies[\"$\".concat(configStrategyCtor.name)];\r\n    }\r\n\r\n    /**\r\n     * Gets a configuration strategy\r\n     * @param {Function} configStrategyCtor\r\n     */\r\n    hasStrategy(configStrategyCtor) {\r\n        Args.notFunction(configStrategyCtor,\"Configuration strategy constructor\");\r\n        return typeof this._strategies[\"$\".concat(configStrategyCtor.name)] !== 'undefined';\r\n    }\r\n\r\n    /**\r\n     * Gets the current configuration\r\n     * @returns ConfigurationBase - An instance of DataConfiguration class which represents the current data configuration\r\n     */\r\n    static getCurrent() {\r\n        if (ConfigurationBase._currentConfiguration == null) {\r\n            ConfigurationBase._currentConfiguration = new ConfigurationBase();\r\n        }\r\n        return ConfigurationBase._currentConfiguration;\r\n    }\r\n\r\n    /**\r\n     * Sets the current configuration\r\n     * @param {ConfigurationBase} configuration\r\n     * @returns ConfigurationBase - An instance of ApplicationConfiguration class which represents the current configuration\r\n     */\r\n    static setCurrent(configuration) {\r\n        if (configuration instanceof ConfigurationBase) {\r\n            if (!configuration.hasStrategy(ModuleLoaderStrategy)) {\r\n                configuration.useStrategy(ModuleLoaderStrategy, DefaultModuleLoaderStrategy);\r\n            }\r\n            ConfigurationBase._currentConfiguration = configuration;\r\n            return ConfigurationBase._currentConfiguration;\r\n        }\r\n        throw new TypeError('Invalid argument. Expected an instance of DataConfiguration class.');\r\n    }\r\n}\r\n\r\nObject.defineProperty(ConfigurationBase, '_currentConfiguration', {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value: null\r\n});\r\n\r\n/**\r\n * @class\r\n * @param {ConfigurationBase} config\r\n * @constructor\r\n * @abstract\r\n */\r\nexport class ConfigurationStrategy {\r\n    constructor(config) {\r\n        Args.check(this.constructor.name !== ConfigurationStrategy.name, new AbstractClassError());\r\n        Args.notNull(config, 'Configuration');\r\n        this._config = config;\r\n    }\r\n\r\n    /**\r\n     * @returns {ConfigurationBase}\r\n     */\r\n    getConfiguration() {\r\n        return this._config;\r\n    }\r\n}\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n * @param {ConfigurationBase} config\r\n * @extends ConfigurationStrategy\r\n */\r\nexport class ModuleLoaderStrategy extends ConfigurationStrategy {\r\n    constructor(config) {\r\n        super(config);\r\n    }\r\n\r\n    require(modulePath) {\r\n        Args.notEmpty(modulePath,'Module Path');\r\n        if (!/^.\\//i.test(modulePath)) {\r\n            if (require.resolve && require.resolve.paths) {\r\n                /**\r\n                 * get require paths collection\r\n                 * @type string[]\r\n                 */\r\n                let paths = require.resolve.paths(modulePath);\r\n                //get execution\r\n                let path1 = this.getConfiguration().getExecutionPath();\r\n                //loop directories to parent (like classic require)\r\n                while (path1) {\r\n                    //if path does not exist in paths collection\r\n                    if (paths.indexOf(PathUtils.join(path1,'node_modules'))<0) {\r\n                        //add it\r\n                        paths.push(PathUtils.join(path1,'node_modules'));\r\n                        //and check the next path which is going to be resolved\r\n                        if (path1 === PathUtils.join(path1,'..')) {\r\n                            //if it is the same with the current path break loop\r\n                            break;\r\n                        }\r\n                        //otherwise get parent path\r\n                        path1 = PathUtils.join(path1,'..');\r\n                    }\r\n                    else {\r\n                        //path already exists in paths collection, so break loop\r\n                        break;\r\n                    }\r\n                }\r\n                let finalModulePath = require.resolve(modulePath, {\r\n                    paths:paths\r\n                });\r\n                return require(finalModulePath);\r\n            }\r\n            else {\r\n                return require(modulePath);\r\n            }\r\n        }\r\n        return require(PathUtils.join(this.getConfiguration().getExecutionPath(),modulePath));\r\n    }\r\n}\r\n\r\n/**\r\n * @classdesc\r\n * @extends ModuleLoaderStrategy\r\n */\r\nexport class DefaultModuleLoaderStrategy extends ModuleLoaderStrategy {\r\n    /**\r\n    * @param {ConfigurationBase} config\r\n    */\r\n    constructor(config) {\r\n        super(config);\r\n    }\r\n}\r\n\r\n\r\n","/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2014-2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport _ from 'lodash';\r\n\r\n// eslint-disable-next-line no-unused-vars\r\n// tslint:disable-next-line:no-unused-variable\r\nconst HTML_START_CHAR = '<';\r\nconst HTML_END_CHAR = '>';\r\nconst HTML_FULL_END_STRING = ' />';\r\nconst HTML_SPACE_CHAR = ' ';\r\nconst HTML_ATTR_STRING = '%0=\"%1\"';\r\nconst HTML_START_TAG_STRING = '<%0';\r\nconst HTML_END_TAG_STRING = '</%0>';\r\n\r\n\r\n/**\r\n * @classdesc HtmlWriter class represents a helper class for rendering HTML content.\r\n * @class\r\n * @constructor\r\n */\r\nexport class HtmlWriter {\r\n    constructor() {\r\n        /**\r\n         * @private\r\n         * @type {Array}\r\n         */\r\n        this.bufferedAttributes=[];\r\n        /**\r\n         * @private\r\n         * @type {Array}\r\n         */\r\n        this.bufferedTags = [];\r\n        /**\r\n         * @private\r\n         * @type {String}\r\n         */\r\n        this.buffer = '';\r\n        /**\r\n         * @private\r\n         * @type {Integer}\r\n         */\r\n        this.indent = true;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Writes an attribute to an array of attributes that is going to be used in writeBeginTag function\r\n     * @param {String} name - The name of the HTML attribute\r\n     * @param {String} value - The value of the HTML attribute\r\n     * @returns {HtmlWriter}\r\n     */\r\n    writeAttribute(name, value) {\r\n        this.bufferedAttributes.push({name:name, value:value});\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Writes an array of attributes to the output buffer. This attributes are going to be rendered after writeBeginTag or WriteFullBeginTag function call.\r\n     * @param {Array|Object} obj - An array of attributes or an object that represents an array of attributes\r\n     * @returns {HtmlWriter}\r\n     */\r\n    writeAttributes(obj) {\r\n        if (obj===null)\r\n            return this;\r\n        if (Array.isArray(obj)) {\r\n            for (let i = 0; i < obj.length; i++) {\r\n                this.bufferedAttributes.push( { name:obj[i].name, value:obj[i].value } );\r\n            }\r\n        }\r\n        else {\r\n            for (let prop in obj)\r\n            {\r\n                if (obj.hasOwnProperty(prop)) {\r\n                    if (obj[prop]!==null) {\r\n                        this.bufferedAttributes.push( { name:prop, value:obj[prop] } );\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * @param {String} tag\r\n     * @returns {HtmlWriter}\r\n     */\r\n    writeBeginTag(tag) {\r\n        //write <TAG\r\n        if (this.indent)\r\n        {\r\n            //this.buffer += '\\n';\r\n            this.buffer += '\\t'.repeat(this.bufferedTags.length);\r\n        }\r\n        this.buffer += HTML_START_TAG_STRING.replace(/%0/, tag);\r\n        this.bufferedTags.push(tag);\r\n        if (this.bufferedAttributes.length>0)\r\n        {\r\n            let s = '';\r\n            this.bufferedAttributes.forEach(attr => {\r\n                //write attribute='value'\r\n                s += HTML_SPACE_CHAR;\r\n                s += HTML_ATTR_STRING.replace(/%0/,attr.name).replace(/%1/, _.escape(attr.value));\r\n            });\r\n            this.buffer += s;\r\n        }\r\n        this.bufferedAttributes.splice(0,this.bufferedAttributes.length);\r\n        this.buffer += HTML_END_CHAR;\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Writes a full begin HTML tag (e.g <div/>).\r\n     * @param {String} tag\r\n     * @returns {HtmlWriter}\r\n     */\r\n    writeFullBeginTag(tag) {\r\n        //write <TAG\r\n        if (this.indent)\r\n        {\r\n            this.buffer += '\\n';\r\n            this.buffer +=_.repeat('\\t', this.bufferedTags.length);\r\n        }\r\n        this.buffer += HTML_START_TAG_STRING.replace(/%0/, tag);\r\n        if (this.bufferedAttributes.length>0)\r\n        {\r\n            let s = '';\r\n            this.bufferedAttributes.forEach( attr => {\r\n                //write attribute='value'\r\n                s += HTML_SPACE_CHAR;\r\n                s += HTML_ATTR_STRING.replace(/%0/,attr.name).replace(/%1/, _.escape(attr.value));\r\n            });\r\n            this.buffer += s;\r\n        }\r\n        this.bufferedAttributes.splice(0,this.bufferedAttributes.length);\r\n        this.buffer += HTML_FULL_END_STRING;\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Writes an end HTML tag (e.g </div>) based on the current buffered tags.\r\n     * @returns {HtmlWriter}\r\n     */\r\n    writeEndTag() {\r\n        const tagsLength = this.bufferedTags ? this.bufferedTags.length : 0;\r\n        if (tagsLength===0)\r\n            return this;\r\n        if (this.indent)\r\n        {\r\n            this.buffer += '\\n';\r\n            this.buffer +=_.repeat('\\t', tagsLength-1);\r\n        }\r\n        this.buffer += HTML_END_TAG_STRING.replace(/%0/,this.bufferedTags[tagsLength-1]);\r\n        this.bufferedTags.splice(tagsLength-1,1);\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     *\r\n     * @param {String} s\r\n     * @returns {HtmlWriter}\r\n     */\r\n    writeText(s) {\r\n        if (!s)\r\n            return this;\r\n        if (this.indent)\r\n        {\r\n            this.buffer += '\\n';\r\n            this.buffer +=_.repeat('\\t', this.bufferedTags.length);\r\n        }\r\n        this.buffer += _.escape(s);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {String} s\r\n     * @returns {HtmlWriter}\r\n     */\r\n    write(s) {\r\n        this.buffer += s;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    toString() {\r\n        return this.buffer;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * @param {function} fn\r\n     */\r\n    writeTo(fn) {\r\n        if (typeof fn === 'function') {\r\n            //call function\r\n            fn(this.buffer);\r\n            //and clear buffer\r\n            this.buffer='';\r\n            //and clear buffered tags\r\n            this.bufferedTags.splice(0,this.bufferedTags.length);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * MOST Web Framework 3.0 Codename Zero Gravity\r\n * Copyright (c) 2014-2019, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport {AbstractMethodError} from \"./errors\";\r\nimport {AbstractClassError} from \"./errors\";\r\n\r\n/**\r\n *\r\n * @class\r\n * @abstract\r\n * @param {string=} configPath\r\n */\r\nclass IApplication {\r\n    // eslint-disable-next-line no-unused-vars\r\n    constructor(_configPath) {\r\n        if (this.constructor === IApplication.prototype.constructor) {\r\n            throw new AbstractClassError();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Registers an application strategy e.g. an singleton service which to be used in application contextr\r\n     * @param {Function} serviceCtor\r\n     * @param {Function} strategyCtor\r\n     * @returns IApplication\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    useStrategy(serviceCtor, strategyCtor) {\r\n        throw new AbstractMethodError();\r\n    }\r\n\r\n    /**\r\n    * @param {Function} serviceCtor\r\n    * @returns {boolean}\r\n    */\r\n    // eslint-disable-next-line no-unused-vars\r\n    hasStrategy(serviceCtor) {\r\n        throw new AbstractMethodError();\r\n    }\r\n\r\n    /**\r\n     * Gets an application strategy based on the given base service type\r\n     * @param {Function} serviceCtor\r\n     * @return {*}\r\n     */\r\n    // eslint-disable-next-line no-unused-vars\r\n    getStrategy(serviceCtor) {\r\n        throw new AbstractMethodError();\r\n    }\r\n\r\n    /**\r\n     * @returns {ConfigurationBase}\r\n     */\r\n    getConfiguration() {\r\n        throw new AbstractMethodError();\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @class\r\n * @abstract\r\n * @param {IApplication} app\r\n */\r\n// eslint-disable-next-line no-unused-vars\r\nclass IApplicationService {\r\n    constructor(app) {\r\n        if (this.constructor === IApplicationService.prototype.constructor) {\r\n            throw new AbstractClassError();\r\n        }\r\n    }\r\n    /**\r\n     * @returns {IApplication}\r\n     */\r\n    getApplication() {\r\n        throw new AbstractMethodError();\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * @classdesc Represents an application service\r\n * @class\r\n */\r\n// eslint-disable-next-line no-unused-vars\r\nclass ApplicationService extends IApplication {\r\n    /**\r\n     * @param {IApplication} app\r\n     */\r\n    constructor(app) {\r\n        super(app);\r\n        Object.defineProperty(this, '_app', {\r\n            enumerable: false,\r\n            writable: false,\r\n            value: app\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @returns {IApplication}\r\n     */\r\n    getApplication() {\r\n        return this._app;\r\n    }\r\n}\r\n\r\nexport {IApplication};\r\nexport {IApplicationService};\r\nexport {ApplicationService};\r\n"],"names":["SequentialEventEmitter","event","_args","listeners","Error","argsAndCallback","concat","Array","prototype","slice","call","arguments","length","TypeError","callback","applyEachSeries","apply","EventEmitter","Errors","statusCode","title","message","module","AbstractMethodError","msg","captureStackTrace","constructor","AbstractClassError","CodedError","code","FileNotFoundError","HttpError","status","innerMessage","finalStatus","parseInt","err","errors","find","x","hasOwnProperty","Object","assign","HttpBadRequestError","HttpNotFoundError","HttpMethodNotAllowedError","HttpUnauthorizedError","HttpNotAcceptableError","HttpRequestTimeoutError","HttpConflictError","HttpTokenExpiredError","HttpTokenRequiredError","HttpForbiddenError","HttpServerError","HttpServiceUnavailable","DataError","model","field","additionalData","NotNullError","DataNotFoundError","AccessDeniedError","UniqueConstraintError","IS_NODE","toString","process","UUID_CHARS","HEX_CHARS","STRIP_COMMENTS","DATE_TIME_REGEX","BOOLEAN_TRUE_REGEX","BOOLEAN_FALSE_REGEX","NULL_REGEX","UNDEFINED_REGEX","INT_REGEX","FLOAT_REGEX","GUID_REGEX","LOG_LEVELS","error","warn","info","verbose","debug","UnknownPropertyDescriptor","obj","name","defineProperty","configurable","enumerable","get","set","value","LangUtils","ctor","superCtor","utilModule","util","require","inherits","create","writable","setPrototypeOf","__proto__","super_","fn","fnStr","replace","result","indexOf","match","parseFloat","Date","parse","origin","expr","options","convertValues","exec","descriptor","expr1","test","isArray","substr","index","extend","re","typedValue","convert","push","form","keys","forEach","key","any","Args","notNull","res","ArgumentError","arg","isNaN","bind","notNumber","TextUtils","md5","md5module","window","toUTCString","JSON","stringify","crypto","createHash","update","digest","cryptoModule","sha1","sha256","chars","uuid","r","i","Math","random","join","TraceLogger","colors","level","env","NODE_ENV","check","data","args","writeError","write","sprintf","text","console","log","timestamp","toUpperCase","TraceUtils","logger","_logger","_data","RandomUtils","str","randomInt","min","max","floor","NumberUtils","s","num","a","charCodeAt","out","String","fromCharCode","PathUtils","_part","pathModule","path","parts","l","split","newParts","part1","pop","unshift","filter","stack","map","Base26Number","thisValue","toBase26","Guid","_value","newUUID","b","toLowerCase","cwd","location","pathname","ConfigurationBase","configPath","_configurationPath","_executionPath","useStrategy","ModuleLoaderStrategy","DefaultModuleLoaderStrategy","configSourcePath","_config","settings","p","_","at","configStrategyCtor","strategyCtor","notFunction","_strategies","_currentConfiguration","configuration","hasStrategy","ConfigurationStrategy","config","modulePath","notEmpty","resolve","paths","path1","getConfiguration","getExecutionPath","finalModulePath","HTML_END_CHAR","HTML_FULL_END_STRING","HTML_SPACE_CHAR","HTML_ATTR_STRING","HTML_START_TAG_STRING","HTML_END_TAG_STRING","HtmlWriter","bufferedAttributes","bufferedTags","buffer","indent","prop","tag","repeat","attr","escape","splice","tagsLength","IApplication","_configPath","serviceCtor","IApplicationService","app","ApplicationService","_app"],"mappings":"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"}